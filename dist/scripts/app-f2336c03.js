"use strict";function updateBackground(e){var o=angular.element($("#bg")).scope();_.defer(function(){o.$apply(function(){console.log(o),o.bg=e})})}!function(){angular.module("pchk-layout",["pchk-core"]).config(["$stateProvider",function(e){e.state("layout",{templateUrl:"app/components/layout/layout.html"}).state("main",{parent:"layout","abstract":!0,views:{header:{templateUrl:"app/components/layout/header/header.html",controller:"HeaderCtrl as header"},footer:{templateUrl:"app/components/layout/footer/footer.html",controller:"FooterCtrl as footer"}}})}])}(),function(){angular.module("pchk-layout").controller("HeaderCtrl",function(){})}(),function(){angular.module("pchk-layout").controller("FooterCtrl",function(){})}(),function(){angular.module("pchk-core",["ngCookies","ngTouch","ngSanitize","restangular","ui.router","ui.bootstrap","ngAnimate"])}(),function(){angular.module("pchk-directives",["pchk-core"]).directive("backImg",function(){return function(e,o,t){t.$observe("backImg",function(e){o.css({"background-image":"url("+e+")","background-size":"cover","background-position":"center",opacity:"0.25"})})}})}(),function(){angular.module("pchk-locations",["pchk-core"]).config(["$stateProvider",function(e){e.state("main.locations",{url:"/locations/:woeid",data:{breadcrumb:["main.home"],title:"Pollen d une location"},views:{"content@layout":{templateUrl:"app/locations/locations.html",controller:"LocationsCtrl as locations"}}})}])}(),function(){angular.module("pchk-locations").factory("LocationsService",["Restangular","$http",function(e,o){return{getForecastFromLocation:function(o){return e.one("forecasts",o).get()},getPhotoFromLocation:function(e){return o({method:"GET",url:"https://api.flickr.com/services/rest/",params:{method:"flickr.photos.search",api_key:"b1e323d889060512b7690c8c24cc1de6",tags:["street","architecture","building","skyscraper","urban"].join(","),tags_mode:"any",sort:"interestingness-desc",privacy_filter:1,accuracy:11,safe_search:1,content_type:1,woe_id:e,media:"photos",extras:["url_o","url_l","license"].join(","),license:[1,2,3,4,5,6,7,8,9,10].join(","),format:"json",nojsoncallback:1}})}}}])}(),function(){angular.module("pchk-locations").controller("LocationsCtrl",["$stateParams","LocationsService",function(e,o){var t=this;updateBackground("assets/images/bg.jpg"),o.getForecastFromLocation(e.woeid).then(function(e){t.pollens=e.periods,t.city=e.location.name,t.woeid=e.woeid}),o.getPhotoFromLocation(e.woeid).success(function(e){if(e){var o=t.getRightUrl(e.photos.photo);o&&(updateBackground(o.url_o),t.photo={url:"https://www.flickr.com/photos/"+o.owner+"/"+o.id})}}).error(function(){t.photo={source:"",url:""}}),t.getRightUrl=function(e){for(var o="",t=Math.round(Math.random()*e.length),a=0,n=t;n<e.length&&!(a>e.length);Math.round(Math.random()*e.length)){if(e[n].url_o&&e[n].width_o>e[n].height_o){o=e[n],console.log(o);break}a++}return o},t.classFromLevel=function(e){var o="";switch(e){case"very_low":o="levelVeryLow";break;case"low":o="levelLow";break;case"medium":o="levelMedium";break;case"high":o="levelHigh";break;case"very_high":o="levelVeryHigh";break;default:o="levelDefault"}return o}}])}(),function(){angular.module("pchk-home",["pchk-core","pchk-directives"]).config(["$stateProvider",function(e){e.state("main.home",{url:"/",data:{breadcrumb:[],title:"Pollen Checker"},views:{"content@layout":{templateUrl:"app/home/home.html",controller:"HomeCtrl as home"}}})}])}(),function(){angular.module("pchk-home").factory("PlacesService",["Restangular","$http","$q",function(e,o){return{getCitiesInfo:function(e){return o({method:"GET",url:"http://where.yahooapis.com/v1/places$and(.q('"+e+"'),.type(7));start=0;count=5",params:{appid:"dj0yJmk9MFJhc1hlQTJNYXVLJmQ9WVdrOVQwbGpia2h1Tkc4bWNHbzlNQS0tJnM9Y29uc3VtZXJzZWNyZXQmeD05Mw--",format:"json"}})},getCityInfo:function(e){return o({method:"GET",url:"http://where.yahooapis.com/v1/places$and(.q('"+e+"'),.type(7))",params:{appid:"dj0yJmk9MFJhc1hlQTJNYXVLJmQ9WVdrOVQwbGpia2h1Tkc4bWNHbzlNQS0tJnM9Y29uc3VtZXJzZWNyZXQmeD05Mw--",format:"json"}})},getContinentFromWoeid:function(e){return o({method:"GET",url:"http://where.yahooapis.com/v1/place/"+e+"/belongtos.type(29)",params:{appid:"dj0yJmk9MFJhc1hlQTJNYXVLJmQ9WVdrOVQwbGpia2h1Tkc4bWNHbzlNQS0tJnM9Y29uc3VtZXJzZWNyZXQmeD05Mw--",format:"json"}})}}}])}(),function(){angular.module("pchk-home").controller("HomeCtrl",["Restangular","PlacesService","$state",function(e,o,t){var a=this;a.cities=[],a.validForm=function(){console.log("validForm"),a.city&&a.city.length>=3&&o.getCityInfo(a.city).success(function(e){if(e){var o=e.places.place[0];o&&o.woeid&&t.go("main.locations",{woeid:o.woeid})}})},a.keyUp=function(){a.city&&a.city.length>=3&&o.getCitiesInfo(a.city).success(function(e){e&&(a.cities=e.places.place)})},updateBackground("assets/images/bg.jpg")}])}(),function(){angular.module("pchk-error",["pchk-core"]).config(["$stateProvider",function(e){e.state("error",{url:"/404",templateUrl:"app/error/404.html"})}])}(),function(){angular.module("pollenChecker",["pchk-core","pchk-layout","pchk-error","pchk-home","pchk-locations"]).config(["$urlRouterProvider","RestangularProvider",function(e,o){e.when("","/"),e.otherwise("/404"),o.setBaseUrl("https://pollencheck.p.mashape.com/api/1/"),o.setDefaultHeaders({"X-Mashape-Key":"bOjN5CeQm1mshRWRxL9A7LpJcGnVp1i3YJKjsnXjhLKw9XJ5MP"})}])}(),angular.module("pollenChecker").run(["$templateCache",function(e){e.put("app/error/404.html",'<div id="center-container"><div><h1>404</h1></div><div><a class="btn btn-info" ui-sref="main.home"><i class="fa fa-home"></i> Retour Ã  l\'accueil</a></div></div>'),e.put("app/home/home.html",'<div class="container"><form ng-submit="home.validForm()"><div class="input-group input-group-lg"><input type="text" ng-keyup="home.keyUp()" ng-model="home.city" class="form-control" placeholder="Type a european city here" aria-describedby="sizing-addon1"> <span class="input-group-btn"><button class="btn btn-danger" type="submit">Go!</button></span></div><ul ng-repeat="place in home.cities"><li><a ui-sref="main.locations({woeid: place.woeid})">{{place.name}} ({{place.admin1}}, {{place.country}} )</a></li></ul></form></div>'),e.put("app/locations/locations.html",'<div class="container"><h1>{{locations.city}}</h1><div class="row fadein fadeout" ng-show="locations.pollens"><div class="col-xs-12 col-sm-6 col-md-3 pollenLevel"><a href="#" class="thumbnail"><img src="assets/images/ragweed.jpg" alt="Ragweed" class="img-circle {{locations.classFromLevel(locations.pollens[0].ragweed.maxLevel)}}"></a><h3>Ragweed</h3></div><div class="col-xs-12 col-sm-6 col-md-3 pollenLevel"><a href="#" class="thumbnail"><img src="assets/images/birch.jpg" alt="Birch" class="img-circle {{locations.classFromLevel(locations.pollens[0].birch.maxLevel)}}"></a><h3>Birch</h3></div><div class="col-xs-12 col-sm-6 col-md-3 pollenLevel"><a href="#" class="thumbnail"><img src="assets/images/grass.jpg" alt="Grass" class="img-circle {{locations.classFromLevel(locations.pollens[0].grass.maxLevel)}}"></a><h3>Grass</h3></div><div class="col-xs-12 col-sm-6 col-md-3 pollenLevel"><a href="#" class="thumbnail"><img src="assets/images/olive.jpg" alt="Olive" class="img-circle {{locations.classFromLevel(locations.pollens[0].olive.maxLevel)}}"></a><h3>Olive</h3></div></div><a ng-show="locations.photo.url" href="{{locations.photo.url}}">Source de l\'image</a></div>'),e.put("app/components/layout/layout.html",'<header class="header" ui-view="header"></header><div class="content"><div class="container" ui-view="content"></div></div><footer ui-view="footer"></footer>'),e.put("app/components/layout/footer/footer.html","<div></div>"),e.put("app/components/layout/header/header.html",'<div role="navigation"><div class="container"><div class="navbar-header"></div></div></div>')}]);