"use strict";function updateBackground(e){var o=angular.element($("#bg")).scope();_.defer(function(){o.$apply(function(){o.bg=e})})}!function(){angular.module("pchk-layout",["pchk-core"]).config(["$stateProvider",function(e){e.state("layout",{templateUrl:"app/components/layout/layout.html"}).state("main",{parent:"layout","abstract":!0,views:{header:{templateUrl:"app/components/layout/header/header.html",controller:"HeaderCtrl as header"},footer:{templateUrl:"app/components/layout/footer/footer.html",controller:"FooterCtrl as footer"}}})}])}(),function(){angular.module("pchk-layout").controller("HeaderCtrl",function(){})}(),function(){angular.module("pchk-layout").controller("FooterCtrl",function(){})}(),function(){angular.module("pchk-core",["ngCookies","ngTouch","ngSanitize","restangular","ui.router","ui.bootstrap","ngAnimate"])}(),function(){angular.module("pchk-directives",["pchk-core"]).directive("backImg",function(){return function(e,o,a){a.$observe("backImg",function(e){o.css({"background-image":"url("+e+")","background-size":"cover","background-position":"center",opacity:"0.25"})})}})}(),function(){angular.module("pchk-core").constant("whereAppId","dj0yJmk9MFJhc1hlQTJNYXVLJmQ9WVdrOVQwbGpia2h1Tkc4bWNHbzlNQS0tJnM9Y29uc3VtZXJzZWNyZXQmeD05Mw--"),angular.module("pchk-core").constant("flickrAppKey","b1e323d889060512b7690c8c24cc1de6"),angular.module("pchk-core").constant("forecastAppId","bOjN5CeQm1mshRWRxL9A7LpJcGnVp1i3YJKjsnXjhLKw9XJ5MP")}(),function(){angular.module("pchk-locations",["pchk-core"]).config(["$stateProvider",function(e){e.state("main.locations",{url:"/locations/:woeid",data:{breadcrumb:["main.home"],title:"Pollen d une location"},views:{"content@layout":{templateUrl:"app/locations/locations.html",controller:"LocationsCtrl as locations"}}})}])}(),function(){angular.module("pchk-locations").factory("LocationsService",["Restangular","$http","flickrAppKey",function(e,o,a){return{getForecastFromLocation:function(o){return e.one("forecasts",o).get()},getPhotoFromLocation:function(e){return o({method:"GET",url:"https://api.flickr.com/services/rest/",params:{method:"flickr.photos.search",api_key:a,tags:["street","architecture","building","skyscraper","urban"].join(","),tags_mode:"any",sort:"interestingness-desc",privacy_filter:1,accuracy:11,safe_search:1,content_type:1,woe_id:e,media:"photos",extras:["url_o","url_l","license"].join(","),license:[1,2,3,4,5,6,7,8,9,10].join(","),format:"json",nojsoncallback:1}})}}}])}(),function(){angular.module("pchk-locations").controller("LocationsCtrl",["$stateParams","LocationsService",function(e,o){var a=this;a.loaded=!1,updateBackground("assets/images/bg.jpg"),o.getForecastFromLocation(e.woeid).then(function(e){a.loaded=!0,a.pollens=e.periods,a.city=e.location.name,a.woeid=e.woeid},function(e){a.loaded=!0,a.error={message:"Sorry, this location does not provide pollen forecast yet"},console.log("Can't reach the forecast API or ressources does not exist:"),console.log(e)}),o.getPhotoFromLocation(e.woeid).success(function(e){if(e&&e.photos&&e.photos.photo){var o=a.getRightUrl(e.photos.photo);o&&(updateBackground(o.url_o),a.photo={url:"https://www.flickr.com/photos/"+o.owner+"/"+o.id})}}).error(function(){a.photo={source:"",url:""}}),a.getRightUrl=function(e){for(var o="",a=Math.round(Math.random()*e.length),t=0,r=a;r<e.length&&!(t>e.length);Math.round(Math.random()*e.length)){if(e[r].url_o&&e[r].width_o>e[r].height_o){o=e[r];break}t++}return o},a.classFromLevel=function(e){var o="";switch(e){case"very_low":o="levelVeryLow";break;case"low":o="levelLow";break;case"medium":o="levelMedium";break;case"high":o="levelHigh";break;case"very_high":o="levelVeryHigh";break;default:o="levelDefault"}return o}}])}(),function(){angular.module("pchk-home",["pchk-core","pchk-directives"]).config(["$stateProvider",function(e){e.state("main.home",{url:"/",data:{breadcrumb:[],title:"Pollen Checker"},views:{"content@layout":{templateUrl:"app/home/home.html",controller:"HomeCtrl as home"}}})}]),angular.module("pchk-home").constant("europeanCountries",[23424950,23424897,23424925,23424744,23424892,23424986,23424819,23424853,23424833,26812346,23424742,23424957,20069817,23424843,23424761,23424879,23424945,20069818,23424881,23424757,23424771,23424750,23424969,23424909,23424844,23424829,23424975,23424933,23424810,23424877,23424803,23424885,23424923,23424796,23424976,23424875,23424765,23424874,23424805,23424954,23424910,23424845,23424812])}(),function(){angular.module("pchk-home").factory("PlacesService",["Restangular","$http","$q","whereAppId",function(e,o,a,t){return{getCitiesInfo:function(e){return o({method:"GET",url:"http://where.yahooapis.com/v1/places$and(.q('"+e+"'),.type(7));start=0;count=5",params:{appid:t,format:"json"}})},getCityInfo:function(e){return o({method:"GET",url:"http://where.yahooapis.com/v1/places$and(.q('"+e+"'),.type(7))",params:{appid:t,format:"json"}})},getContinentFromWoeid:function(e){return o({method:"GET",url:"http://where.yahooapis.com/v1/place/"+e+"/belongtos.type(29)",params:{appid:t,format:"json"}})}}}])}(),function(){angular.module("pchk-home").controller("HomeCtrl",["Restangular","PlacesService","$state","europeanCountries",function(e,o,a,t){updateBackground("assets/images/bg.jpg");var r=this;r.cities=[],r.loaded=!0,r.goloaded=!0,r.validForm=function(){r.goloaded=!1,r.city&&r.city.length>=3&&o.getCityInfo(r.city).success(function(e){if(r.error=null,e){var o=e.places.place[0];o&&o.woeid&&a.go("main.locations",{woeid:o.woeid})}}).error(function(e){r.goloaded=!0,r.error={code:e?e.status:"",message:"Sorry, we can't reach your location right now. Come back later."},console.log("Can't reach the Yahoo Geoplanet API or the limit is reached."),console.log(e)})},r.keyUp=function(){r.city&&r.city.length>=3&&(r.loaded=!1,o.getCitiesInfo(r.city).success(function(e){r.error=null,e&&(r.cities=r.filterEuropeanCountries(e.places.place),r.loaded=!0)}).error(function(e){r.loaded=!0,r.error={code:e?e.status:"",message:"Sorry, we can't reach your location right now. Come back later."},console.log("Can't reach the Yahoo Geoplanet API or the limit is reached."),console.log(e)}))},r.filterEuropeanCountries=function(e){var o=0,a=[];if(e)for(var r=0;r<e.length;r++){var n=e[r];t.indexOf(n["country attrs"].woeid)>-1&&(a[o]=n,o++)}return a}}])}(),function(){angular.module("pchk-error",["pchk-core"]).config(["$stateProvider",function(e){e.state("error",{url:"/404",templateUrl:"app/error/404.html"})}])}(),function(){angular.module("pollenChecker",["pchk-core","pchk-layout","pchk-error","pchk-home","pchk-locations"]).config(["$urlRouterProvider","RestangularProvider","forecastAppId",function(e,o,a){e.when("","/"),e.otherwise("/404"),o.setBaseUrl("https://pollencheck.p.mashape.com/api/1/"),o.setDefaultHeaders({"X-Mashape-Key":a})}])}(),angular.module("pollenChecker").run(["$templateCache",function(e){e.put("app/error/404.html",'<div id="center-container"><div><h1>404</h1></div><div><a class="btn btn-info" ui-sref="main.home"><i class="fa fa-home"></i> Retour Ã  l\'accueil</a></div></div>'),e.put("app/locations/locations.html",'<div class="loading" ng-show="!locations.loaded"><i class="fa fa-spinner fa-spin fa-5x"></i></div><div class="container"><h1>{{locations.city}}</h1><div class="error-message" ng-show="locations.error.message"><div><span class="fa fa-frown-o fa-5x"></span></div><div><p>{{locations.error.message}}.</p><p><a ui-sref="main.home">Search another location</a></p></div></div><div class="row fadein fadeout" ng-show="locations.pollens"><div class="col-xs-6 col-sm-6 col-md-3 pollenLevel"><a href="#" class="thumbnail"><img src="assets/images/ragweed.jpg" alt="Ragweed" class="img-circle {{locations.classFromLevel(locations.pollens[0].ragweed.maxLevel)}}"></a><h3>Ragweed</h3></div><div class="col-xs-6 col-sm-6 col-md-3 pollenLevel"><a href="#" class="thumbnail"><img src="assets/images/birch.jpg" alt="Birch" class="img-circle {{locations.classFromLevel(locations.pollens[0].birch.maxLevel)}}"></a><h3>Birch</h3></div><div class="col-xs-6 col-sm-6 col-md-3 pollenLevel"><a href="#" class="thumbnail"><img src="assets/images/grass.jpg" alt="Grass" class="img-circle {{locations.classFromLevel(locations.pollens[0].grass.maxLevel)}}"></a><h3>Grass</h3></div><div class="col-xs-6 col-sm-6 col-md-3 pollenLevel"><a href="#" class="thumbnail"><img src="assets/images/olive.jpg" alt="Olive" class="img-circle {{locations.classFromLevel(locations.pollens[0].olive.maxLevel)}}"></a><h3>Olive</h3></div></div><a ng-show="locations.photo.url" href="{{locations.photo.url}}">Source de l\'image</a></div>'),e.put("app/home/home.html",'<div class="container"><form ng-submit="home.validForm()"><div class="input-group input-group-lg"><input type="text" ng-keyup="home.keyUp()" ng-model="home.city" class="form-control" placeholder="Type a european city here" aria-describedby="sizing-addon1"> <span class="input-group-btn"><button class="btn btn-danger" type="submit"><i ng-show="!home.goloaded" class="fa fa-spinner fa-spin fa-1x"></i>Go!</button></span></div><div class="error-message" ng-show="home.error.message"><span class="fa fa-frown-o">{{home.error.message}}</span></div><div ng-show="!home.loaded"><i class="fa fa-spinner fa-spin fa-1x"></i></div><ul ng-repeat="place in home.cities"><li><a ui-sref="main.locations({woeid: place.woeid})">{{place.name}} ({{place.admin1?place.admin1+", ":""}}{{place.country}})</a></li></ul></form></div>'),e.put("app/components/layout/layout.html",'<header class="header" ui-view="header"></header><div class="content"><div class="container" ui-view="content"></div></div><footer ui-view="footer"></footer>'),e.put("app/components/layout/header/header.html",'<div role="navigation"><div class="container"><div class="navbar-header"></div></div></div>'),e.put("app/components/layout/footer/footer.html","<div></div>")}]);